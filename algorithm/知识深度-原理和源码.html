<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>知识深度-原理和源码 | 张晓伟-技术文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/images/photo.jpg">
    <link rel="manifest" href="/images/photo.jpg">
    <link rel="apple-touch-icon" href="/images/photo.jpg">
    <meta name="description" content="Personal Website">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.f46d1901.css" as="style"><link rel="preload" href="/assets/js/app.ac5ad06d.js" as="script"><link rel="preload" href="/assets/js/3.c24abbc0.js" as="script"><link rel="preload" href="/assets/js/13.7502b3ed.js" as="script"><link rel="prefetch" href="/assets/js/10.4fec8d03.js"><link rel="prefetch" href="/assets/js/100.992dc290.js"><link rel="prefetch" href="/assets/js/101.44509c85.js"><link rel="prefetch" href="/assets/js/102.956b0216.js"><link rel="prefetch" href="/assets/js/103.0083806d.js"><link rel="prefetch" href="/assets/js/104.d3d9a461.js"><link rel="prefetch" href="/assets/js/105.ee725b55.js"><link rel="prefetch" href="/assets/js/106.e0794f99.js"><link rel="prefetch" href="/assets/js/107.30abcf83.js"><link rel="prefetch" href="/assets/js/108.a7ebdef7.js"><link rel="prefetch" href="/assets/js/109.e61fb0a2.js"><link rel="prefetch" href="/assets/js/11.3fa19d12.js"><link rel="prefetch" href="/assets/js/110.1bdc75a2.js"><link rel="prefetch" href="/assets/js/111.ace68420.js"><link rel="prefetch" href="/assets/js/112.e50d891e.js"><link rel="prefetch" href="/assets/js/113.834ab4ca.js"><link rel="prefetch" href="/assets/js/114.1b3f5e5d.js"><link rel="prefetch" href="/assets/js/115.207013e4.js"><link rel="prefetch" href="/assets/js/116.15c76d7b.js"><link rel="prefetch" href="/assets/js/117.fb69ce83.js"><link rel="prefetch" href="/assets/js/118.f390ddaf.js"><link rel="prefetch" href="/assets/js/119.f88e1d30.js"><link rel="prefetch" href="/assets/js/12.ebaa0477.js"><link rel="prefetch" href="/assets/js/120.5d59a0e1.js"><link rel="prefetch" href="/assets/js/121.bf67b374.js"><link rel="prefetch" href="/assets/js/122.c73bc3e6.js"><link rel="prefetch" href="/assets/js/123.36e363e4.js"><link rel="prefetch" href="/assets/js/124.10c7815d.js"><link rel="prefetch" href="/assets/js/125.6bfdaa7f.js"><link rel="prefetch" href="/assets/js/126.b105ace1.js"><link rel="prefetch" href="/assets/js/127.603f4797.js"><link rel="prefetch" href="/assets/js/128.84b95f8e.js"><link rel="prefetch" href="/assets/js/129.e89f5af8.js"><link rel="prefetch" href="/assets/js/130.7dbbdac1.js"><link rel="prefetch" href="/assets/js/131.24141011.js"><link rel="prefetch" href="/assets/js/132.9e3b6479.js"><link rel="prefetch" href="/assets/js/133.32c71b91.js"><link rel="prefetch" href="/assets/js/134.affa7fe9.js"><link rel="prefetch" href="/assets/js/135.06ff9d21.js"><link rel="prefetch" href="/assets/js/136.13323d46.js"><link rel="prefetch" href="/assets/js/137.5bb332e9.js"><link rel="prefetch" href="/assets/js/138.bad0911a.js"><link rel="prefetch" href="/assets/js/139.22b585b1.js"><link rel="prefetch" href="/assets/js/14.b0c75e60.js"><link rel="prefetch" href="/assets/js/140.30d9b40a.js"><link rel="prefetch" href="/assets/js/141.45b17106.js"><link rel="prefetch" href="/assets/js/142.9a98fd75.js"><link rel="prefetch" href="/assets/js/143.2aa20922.js"><link rel="prefetch" href="/assets/js/144.695d4acd.js"><link rel="prefetch" href="/assets/js/145.b2b2df24.js"><link rel="prefetch" href="/assets/js/146.b3c8c8db.js"><link rel="prefetch" href="/assets/js/147.6be833e8.js"><link rel="prefetch" href="/assets/js/148.9835db24.js"><link rel="prefetch" href="/assets/js/149.f9fc5086.js"><link rel="prefetch" href="/assets/js/15.feabe304.js"><link rel="prefetch" href="/assets/js/150.ec4d1cda.js"><link rel="prefetch" href="/assets/js/151.56de4c87.js"><link rel="prefetch" href="/assets/js/152.e9fa4bbf.js"><link rel="prefetch" href="/assets/js/153.b2a9188f.js"><link rel="prefetch" href="/assets/js/154.6da1de78.js"><link rel="prefetch" href="/assets/js/155.0361146d.js"><link rel="prefetch" href="/assets/js/16.a6767286.js"><link rel="prefetch" href="/assets/js/17.22c6ba9a.js"><link rel="prefetch" href="/assets/js/18.ef0cd39a.js"><link rel="prefetch" href="/assets/js/19.8899dfa5.js"><link rel="prefetch" href="/assets/js/2.ae6673a1.js"><link rel="prefetch" href="/assets/js/20.4c6f1994.js"><link rel="prefetch" href="/assets/js/21.26422e58.js"><link rel="prefetch" href="/assets/js/22.8afed43d.js"><link rel="prefetch" href="/assets/js/23.1a713867.js"><link rel="prefetch" href="/assets/js/24.0797cbc2.js"><link rel="prefetch" href="/assets/js/25.363cafd4.js"><link rel="prefetch" href="/assets/js/26.4c63cf94.js"><link rel="prefetch" href="/assets/js/27.5ddc91a4.js"><link rel="prefetch" href="/assets/js/28.1691ae01.js"><link rel="prefetch" href="/assets/js/29.b0550db7.js"><link rel="prefetch" href="/assets/js/30.6c54cab9.js"><link rel="prefetch" href="/assets/js/31.548c83d5.js"><link rel="prefetch" href="/assets/js/32.9cb080ba.js"><link rel="prefetch" href="/assets/js/33.c58d8b18.js"><link rel="prefetch" href="/assets/js/34.fc449b00.js"><link rel="prefetch" href="/assets/js/35.88763dbb.js"><link rel="prefetch" href="/assets/js/36.470f5da9.js"><link rel="prefetch" href="/assets/js/37.cfb818fb.js"><link rel="prefetch" href="/assets/js/38.02aa2797.js"><link rel="prefetch" href="/assets/js/39.d473d5bd.js"><link rel="prefetch" href="/assets/js/4.e0787ea2.js"><link rel="prefetch" href="/assets/js/40.c5f32118.js"><link rel="prefetch" href="/assets/js/41.1c48f55d.js"><link rel="prefetch" href="/assets/js/42.e1cad54b.js"><link rel="prefetch" href="/assets/js/43.f0ddfd79.js"><link rel="prefetch" href="/assets/js/44.b6739718.js"><link rel="prefetch" href="/assets/js/45.499d7119.js"><link rel="prefetch" href="/assets/js/46.719a84c3.js"><link rel="prefetch" href="/assets/js/47.43bfb159.js"><link rel="prefetch" href="/assets/js/48.1d57733c.js"><link rel="prefetch" href="/assets/js/49.217a24eb.js"><link rel="prefetch" href="/assets/js/5.57bdc345.js"><link rel="prefetch" href="/assets/js/50.d654b3f4.js"><link rel="prefetch" href="/assets/js/51.a67634e1.js"><link rel="prefetch" href="/assets/js/52.dadb4a39.js"><link rel="prefetch" href="/assets/js/53.c943b577.js"><link rel="prefetch" href="/assets/js/54.1f76b1fb.js"><link rel="prefetch" href="/assets/js/55.1adafb94.js"><link rel="prefetch" href="/assets/js/56.013a3ff7.js"><link rel="prefetch" href="/assets/js/57.d776ed64.js"><link rel="prefetch" href="/assets/js/58.92ad1eef.js"><link rel="prefetch" href="/assets/js/59.4a87bb2b.js"><link rel="prefetch" href="/assets/js/6.2c667b06.js"><link rel="prefetch" href="/assets/js/60.aa6ac53d.js"><link rel="prefetch" href="/assets/js/61.55b356a1.js"><link rel="prefetch" href="/assets/js/62.5bee3ccc.js"><link rel="prefetch" href="/assets/js/63.d9fe3bcf.js"><link rel="prefetch" href="/assets/js/64.a16d5b28.js"><link rel="prefetch" href="/assets/js/65.06d15671.js"><link rel="prefetch" href="/assets/js/66.00ec76c5.js"><link rel="prefetch" href="/assets/js/67.cf30dc53.js"><link rel="prefetch" href="/assets/js/68.8b981571.js"><link rel="prefetch" href="/assets/js/69.ac78ebab.js"><link rel="prefetch" href="/assets/js/7.818633d1.js"><link rel="prefetch" href="/assets/js/70.0cd461a4.js"><link rel="prefetch" href="/assets/js/71.26b88a69.js"><link rel="prefetch" href="/assets/js/72.a3ea13ac.js"><link rel="prefetch" href="/assets/js/73.0b7a21c0.js"><link rel="prefetch" href="/assets/js/74.cbbdc6d1.js"><link rel="prefetch" href="/assets/js/75.7e088dc7.js"><link rel="prefetch" href="/assets/js/76.647db7af.js"><link rel="prefetch" href="/assets/js/77.e19dce67.js"><link rel="prefetch" href="/assets/js/78.2435218a.js"><link rel="prefetch" href="/assets/js/79.2654ba52.js"><link rel="prefetch" href="/assets/js/8.4563f6fd.js"><link rel="prefetch" href="/assets/js/80.82f9eeda.js"><link rel="prefetch" href="/assets/js/81.9f574172.js"><link rel="prefetch" href="/assets/js/82.c462304c.js"><link rel="prefetch" href="/assets/js/83.e1a6a150.js"><link rel="prefetch" href="/assets/js/84.218e1c49.js"><link rel="prefetch" href="/assets/js/85.0ad7284d.js"><link rel="prefetch" href="/assets/js/86.7a304dea.js"><link rel="prefetch" href="/assets/js/87.2b138ab8.js"><link rel="prefetch" href="/assets/js/88.5877c2af.js"><link rel="prefetch" href="/assets/js/89.afabfc0a.js"><link rel="prefetch" href="/assets/js/9.13bca455.js"><link rel="prefetch" href="/assets/js/90.37e88d63.js"><link rel="prefetch" href="/assets/js/91.38382406.js"><link rel="prefetch" href="/assets/js/92.cebffc90.js"><link rel="prefetch" href="/assets/js/93.db10cebc.js"><link rel="prefetch" href="/assets/js/94.588db323.js"><link rel="prefetch" href="/assets/js/95.b7a4532f.js"><link rel="prefetch" href="/assets/js/96.c3829955.js"><link rel="prefetch" href="/assets/js/97.3a8e2bd4.js"><link rel="prefetch" href="/assets/js/98.c338c453.js"><link rel="prefetch" href="/assets/js/99.d9f57dca.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f46d1901.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">张晓伟-技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/engineering/" class="nav-link">
  吃透前端工程化
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link router-link-active">
  大前端
</a></div><div class="nav-item"><a href="/system/" class="nav-link">
  系统分析师
</a></div><div class="nav-item"><a href="/hand/" class="nav-link">
  源码系列
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  数据可视化
</a></div><div class="nav-item"><a href="/mode/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/publish/" class="nav-link">
  前端发布脚手架
</a></div><div class="nav-item"><a href="/wy/" class="nav-link">
  wy高级前端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人Menu" class="dropdown-title"><span class="title">个人</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人Menu" class="mobile-dropdown-title"><span class="title">个人</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://helloonetwo.github.io/xiao-ui-website" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/js-util-zhangxiaowei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人工具类
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-zxw-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/zxw-pages" target="_blank" rel="noopener noreferrer" class="nav-link external">
  自动化构建工作流
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/engineering/" class="nav-link">
  吃透前端工程化
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link router-link-active">
  大前端
</a></div><div class="nav-item"><a href="/system/" class="nav-link">
  系统分析师
</a></div><div class="nav-item"><a href="/hand/" class="nav-link">
  源码系列
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  数据可视化
</a></div><div class="nav-item"><a href="/mode/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/publish/" class="nav-link">
  前端发布脚手架
</a></div><div class="nav-item"><a href="/wy/" class="nav-link">
  wy高级前端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人Menu" class="dropdown-title"><span class="title">个人</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人Menu" class="mobile-dropdown-title"><span class="title">个人</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://helloonetwo.github.io/xiao-ui-website" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/js-util-zhangxiaowei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人工具类
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/generator-zxw-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/package/zxw-pages" target="_blank" rel="noopener noreferrer" class="nav-link external">
  自动化构建工作流
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript 深度剖析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>二周刷完前端面试题目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/algorithm/实际工作经验.html" class="sidebar-link">实际工作经验</a></li><li><a href="/algorithm/软技能.html" class="sidebar-link">软技能</a></li><li><a href="/algorithm/分析解决问题.html" class="sidebar-link">分析解决问题</a></li><li><a href="/algorithm/知识广度-从前端到全栈.html" class="sidebar-link">知识广度-从前端到全栈</a></li><li><a href="/algorithm/知识深度-原理和源码.html" class="active sidebar-link">知识深度-原理和源码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#js-内存泄漏" class="sidebar-link">JS 内存泄漏</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#浏览器和-nodejs-事件循环的区别" class="sidebar-link">浏览器和 nodejs 事件循环的区别</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#vdom-真的很快吗" class="sidebar-link">vdom 真的很快吗</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#for-vs-foreach" class="sidebar-link">for vs forEach</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#nodejs-多进程" class="sidebar-link">nodejs 多进程</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#js-bridge-原理" class="sidebar-link">js-bridge 原理</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#requestidlecallback" class="sidebar-link">requestIdleCallback</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#vue-react-diff" class="sidebar-link">Vue React diff</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#vue-router-模式" class="sidebar-link">Vue-router 模式</a></li><li class="sidebar-sub-header"><a href="/algorithm/知识深度-原理和源码.html#vue-生命周期" class="sidebar-link">Vue 生命周期</a></li></ul></li><li><a href="/algorithm/手写 Promie.html" class="sidebar-link">手写 Promise</a></li><li><a href="/algorithm/JS 异步编程.html" class="sidebar-link">函数式编程</a></li><li><a href="/algorithm/Event Loop.html" class="sidebar-link">Event Loop 机制</a></li><li><a href="/algorithm/TypeScript.html" class="sidebar-link">Typescript</a></li><li><a href="/algorithm/javascript性能优化.html" class="sidebar-link">javascript 性能优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化实战</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue.js 框架源码与进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node 全栈开发</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="知识深度-原理和源码"><a href="#知识深度-原理和源码" class="header-anchor">#</a> 知识深度-原理和源码</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>知识深度-原理和源码</p></div> <h2 id="js-内存泄漏"><a href="#js-内存泄漏" class="header-anchor">#</a> JS 内存泄漏</h2> <h3 id="题目"><a href="#题目" class="header-anchor">#</a> 题目</h3> <p>如何检测 JS 内存泄漏？内存泄漏的场景有哪些？</p> <h3 id="垃圾回收"><a href="#垃圾回收" class="header-anchor">#</a> 垃圾回收</h3> <p>正常情况下，一个函数执行完，其中的变量都会是会 JS 垃圾回收。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token string">'aaa'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">100</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>但某些情况下，变量是销毁不了的，因为可能会被再次使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">100</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span>obj <span class="token operator">=</span> obj <span class="token comment">// 引用到了全局变量，obj 销毁不了</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">genDataFns</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 闭包，data 销毁不了</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> get<span class="token punctuation">,</span> set <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">genDataFns</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>变量销毁不了，一定就是内存泄漏吗？—— 不一定</p> <h3 id="垃圾回收算法-引用计数"><a href="#垃圾回收算法-引用计数" class="header-anchor">#</a> 垃圾回收算法 - 引用计数</h3> <p>早起的垃圾回收算法，以“数据是否被引用”来判断要不要回收。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 对象被 a 引用</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> a1 <span class="token operator">=</span> a <span class="token comment">// 又被 a1 引用</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 不再被 a 引用，但仍然被 a1 引用</span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 不再被 a1 引用</span>

<span class="token comment">// 对象最终没有任何引用，会被回收</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>但这个算法有一个缺陷 —— 循环引用。例如</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    obj1<span class="token punctuation">.</span>a <span class="token operator">=</span> obj2
    obj2<span class="token punctuation">.</span>a <span class="token operator">=</span> obj1 <span class="token comment">// 循环引用，无法回收 obj1 和 obj2</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>此前有一个很著名的例子。IE6、7 使用引用计数算法进行垃圾回收，常常因为循环引用导致 DOM 对象无法进行垃圾回收。<br>
下面的例子，即便界面上删除了 div1 ，但在 JS 内存中它仍然存在，包括它的所有属性。但现代浏览器已经解决了这个问题。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> div1
window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span>
    div1<span class="token punctuation">.</span>aaa <span class="token operator">=</span> div1
    div1<span class="token punctuation">.</span>someBigData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token comment">// 一个体积很大的数据。</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>以上这个例子就是内存泄漏。即，<strong>不希望它存在的，它却仍然存在</strong>，这是不符合预期的。关键在于“泄漏”。</p> <h3 id="垃圾回收算法-标记清除"><a href="#垃圾回收算法-标记清除" class="header-anchor">#</a> 垃圾回收算法 - 标记清除</h3> <p>基于上面的问题，现代浏览器使用“标记-清除”算法。根据“是否是否可获得”来判断是否回收。</p> <p>定期从根（即全局变量）开始向下查找，能找到的即保留，找不到的即回收。循环引用不再是问题。</p> <h3 id="检测内存变化"><a href="#检测内存变化" class="header-anchor">#</a> 检测内存变化</h3> <p>可使用 Chrome devTools Performance 来检测内存变化</p> <ul><li>刷新页面，点击“GC”按钮</li> <li>点击“Record”按钮开始记录，然后操作页面</li> <li>操作结束，点击“GC”按钮，点击“结束”按钮，看分析结果</li></ul> <p>代码参考 <code>memory-change.html</code></p> <h3 id="内存泄漏的场景"><a href="#内存泄漏的场景" class="header-anchor">#</a> 内存泄漏的场景</h3> <p>拿 Vue 来举例说明。</p> <p>组件中有全局变量、函数的引用。组件销毁时要记得清空。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">nums</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function-variable function">printNums</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nums<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// beforeUnmount() {</span>
    <span class="token comment">//     window.printNums = null</span>
    <span class="token comment">// },</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>组件有全局定时器。组件销毁时要记得清除。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token comment">// intervalId: 0,</span>
            <span class="token literal-property property">nums</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// methods: {</span>
    <span class="token comment">//     printNums() {</span>
    <span class="token comment">//         console.log(this.nums)</span>
    <span class="token comment">//     }</span>
    <span class="token comment">// },</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nums<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        
        <span class="token comment">// this.intervalId = setInterval(this.printNums, 200)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">beforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// clearInterval(this.intervalId)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>组件中有全局事件的引用。组件销毁时记得解绑。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">nums</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// methods: {</span>
    <span class="token comment">//     printNums() {</span>
    <span class="token comment">//         console.log(this.nums)</span>
    <span class="token comment">//     }</span>
    <span class="token comment">// },</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nums<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// window.addEventListener('reisze', this.printNums)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">beforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// window.removeEventListener('reisze', this.printNums)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>组件中使用了自定义事件，销毁时要记得解绑。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">nums</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// methods: {</span>
    <span class="token comment">//     printNums() {</span>
    <span class="token comment">//         console.log(this.nums)</span>
    <span class="token comment">//     }</span>
    <span class="token comment">// },</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event-key'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nums<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// event.on('event-key', this.printNums)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">beforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// event.off('event-key', this.printNums)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="闭包是内存泄漏吗"><a href="#闭包是内存泄漏吗" class="header-anchor">#</a> 闭包是内存泄漏吗</h3> <p>上述代码 <code>genDataFns()</code> 就是一个很典型的闭包，闭包的变量是无法被垃圾回收的。</p> <p>但闭包不是内存泄漏，因为它是符合开发者预期的，即本身就这么设计的。而内存泄漏是非预期的。</p> <p>【注意】这一说法没有定论，有些面试官可能会说“不可被垃圾回收就是内存泄漏”，不可较真。</p> <h3 id="答案"><a href="#答案" class="header-anchor">#</a> 答案</h3> <ul><li>可使用 Chrome devTools Performance 检测内存变化</li> <li>内存泄漏的场景
<ul><li>全局变量，函数</li> <li>全局事件</li> <li>全局定时器</li> <li>自定义事件</li> <li>闭包（无定论）</li></ul></li></ul> <h3 id="划重点"><a href="#划重点" class="header-anchor">#</a> 划重点</h3> <p>前端之前不太关注内存泄漏，因为不会像服务单一样 7*24 运行。<br>
而随着现在富客户端系统不断普及，内存泄漏也在慢慢的被重视。</p> <h3 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h3> <p>WeakMap WeakSet 弱引用，不会影响垃圾回收。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 函数执行完，obj 会被销毁，因为外面的 WeakMap 是“弱引用”，不算在内</span>
<span class="token keyword">const</span> wMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zhangsan'</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注意，WeakMap 专门做弱引用的，因此 WeakMap 只接受对象作为键名（`null`除外），不接受其他类型的值作为键名。其他的无意义</span>
    wMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 代码执行完毕之后，obj 会被销毁，wMap 中也不再存在。但我们无法第一时间看到效果。因为：</span>
<span class="token comment">// 内存的垃圾回收机制，不是实时的，而且是 JS 代码控制不了的，因此这里不一定能直接看到效果。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 函数执行完，obj 会被销毁，因为外面的 WeakSet 是“弱引用”，不算在内</span>
<span class="token keyword">const</span> wSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zhangsan'</span>
    <span class="token punctuation">}</span>
    wSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// 注意，WeakSet 就是为了做弱引用的，因此不能 add 值类型！！！无意义</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>wangEditor 多次销毁创建，测试内存泄漏。日常开发时可以参考这种方式<br></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>memory change<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        memory change
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>start<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 模拟一个比较大的数据</span>
            <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">str</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token comment">// 简单的拷贝</span>
            <span class="token punctuation">}</span>

            window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                n<span class="token operator">++</span>

                <span class="token comment">// 执行 50 次</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h2 id="浏览器和-nodejs-事件循环的区别"><a href="#浏览器和-nodejs-事件循环的区别" class="header-anchor">#</a> 浏览器和 nodejs 事件循环的区别</h2> <h3 id="题目-2"><a href="#题目-2" class="header-anchor">#</a> 题目</h3> <p>浏览器和 nodejs 事件循环的区别</p> <h3 id="单线程和异步"><a href="#单线程和异步" class="header-anchor">#</a> 单线程和异步</h3> <p>JS 是单线程的，浏览器中 JS 和 DOM 渲染线程互斥。<br>
单线程，代码就必须“串行”执行，无法并行，同一时间只能干一件事。</p> <p>在 Java 等多线程语言中，发起请求、设置定时任务可以通过新开一个线程来处理，这就是并行。<br>
而 JS 是单线程，这种场景就只能使用“异步”。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="宏任务和微任务"><a href="#宏任务和微任务" class="header-anchor">#</a> 宏任务和微任务</h3> <p>浏览器端异步的 API 有很多</p> <ul><li>宏任务：setTimeout 网络请求</li> <li>微任务：promise</li></ul> <p>两者表面的区别：</p> <p>第一，微任务比宏任务更快执行</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise.then'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>第二，微任务在 DOM 渲染前执行，而宏任务在 DOM 显示后（即真正显示到页面上，肉眼可见）执行</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'new paragraph'</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'length----'</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span>length<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout----'</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'阻塞'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise.then----'</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'阻塞'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="浏览器的事件循环"><a href="#浏览器的事件循环" class="header-anchor">#</a> 浏览器的事件循环</h3> <p>主要的流程</p> <ul><li>执行 JS 同步代码（执行异步 API 时，异步先放在一个队列中，先不执行）</li> <li>DOM 渲染</li> <li>执行队列中的异步函数（执行异步 API 时，异步先放在一个队列中，先不执行）—— 异步中可能还嵌套异步</li> <li>DOM 渲染</li> <li>执行队列中的异步函数（执行异步 API 时，异步先放在一个队列中，先不执行）</li> <li>DOM 渲染</li> <li>...</li></ul> <p><img src="/assets/img/event-loop.ff697470.png" alt=""></p> <p>考虑宏任务和微任务</p> <ul><li>执行 JS 同步代码（异步函数，分别放在 macroTaskQueue 和 microTaskQueue ）</li> <li>DOM 结构渲染（此时还没有在页面显示，但可以获取 DOM 内容了）</li> <li>执行 microTaskQueue 函数（异步中还可能嵌套异步...）</li> <li>显示 DOM 到页面</li> <li>执行 macroTaskQueue 函数（异步中还可能嵌套异步...）</li> <li>...</li></ul> <h3 id="nodejs-异步"><a href="#nodejs-异步" class="header-anchor">#</a> nodejs 异步</h3> <p>nodejs 也是用了 V8 引擎和 ES 语法，所以也有同步、异步，异步也分宏任务、微任务。</p> <ul><li>setTimeout setInterval —— 宏任务</li> <li>promise 和 async/await  —— 微任务</li> <li>process.nextTick —— 微任务，<strong>但优先级最高</strong></li> <li>setImmediate —— 宏任务</li> <li>I/O 文件、网络 —— 宏任务</li> <li>Socket 连接：连接 mysql —— 宏任务</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise then'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="nodejs-事件循环"><a href="#nodejs-事件循环" class="header-anchor">#</a> nodejs 事件循环</h3> <p>浏览器的各种宏任务，都是按照代码的顺序执行的，没有其他优先级。</p> <p>nodejs 的宏任务是分了如下类型，nodejs 事件循环中宏任务需要按照这个顺序来执行。</p> <ul><li>timers(计时器) - 执行 <code>setTimeout</code> 以及 <code>setInterval</code> 的回调</li> <li>I/O callbacks - 处理网络、流、TCP 的错误回调</li> <li>idle, prepare --- 闲置阶段 - node 内部使用</li> <li>poll(轮循) - 执行 poll 中的 I/O 队列，检查定时器是否到时间</li> <li>check(检查) - 存放 <code>setImmediate</code> 回调</li> <li>close callbacks - 关闭回调，例如 <code>socket.on('close')</code></li></ul> <p>nodejs 事件循环的过程</p> <ul><li>执行同步代码</li> <li>执行 <code>process.nextTick</code> 和微任务（前者优先级更高）</li> <li>按照顺序执行 6 个类型的宏任务</li> <li>...</li></ul> <p><img src="/assets/img/event-loop-nodejs.18a2a076.png" alt=""></p> <h3 id="答案-2"><a href="#答案-2" class="header-anchor">#</a> 答案</h3> <ul><li>事件循环的大概模式相同</li> <li>宏任务有优先级区分</li> <li><code>process.nextTick</code> 在微任务的优先级更高</li></ul> <p>但是，<code>process.nextTick</code> 在最新版 nodejs 中不被推荐使用，推荐使用 <code>setImmediate</code>
原因在于 <code>process.nextTick</code> 是在当前帧介绍后立即执行，会阻断IO并且有最大数量限制（递归时会有问题）
而 <code>setImmediate</code> 不会阻断 IO ，更像是 <code>setTimeout(fun, 0)</code></p> <h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <p>基于 nodejs 最新版。nodejs 旧版会有所不同，特别注意。</p> <h2 id="vdom-真的很快吗"><a href="#vdom-真的很快吗" class="header-anchor">#</a> vdom 真的很快吗</h2> <h3 id="题目-3"><a href="#题目-3" class="header-anchor">#</a> 题目</h3> <p>vdom 真的很快吗？</p> <h3 id="vue-react-等框架的存在价值"><a href="#vue-react-等框架的存在价值" class="header-anchor">#</a> Vue React 等框架的存在价值</h3> <p>Vue React 等框架给前端开发带来了革命性的变化。相比于此前的 jQuery 时代，它们的价值在于</p> <ul><li>组件化 —— 这不是核心原因。WebComponent 已提出多年，当仍未发展壮大</li> <li>数据视图分离，数据驱动视图 —— 这才是核心！！！</li></ul> <p>数据视图分离，开发时只需要关注业务数据（React 的 state，Vue 的 data）即可，不用在实时的修改 DOM —— 这一点和 jQuery 有了本质区别。<br>
特别是对于大型的前端项目，将极大的降低开发复杂度，提高稳定性。</p> <p>数据驱动视图，内部将如何实现呢？—— 借助于 vdom</p> <h3 id="vdom"><a href="#vdom" class="header-anchor">#</a> vdom</h3> <p>Virtual DOM，虚拟 DOM ，即用 JS 对象模拟 DOM 数据。是 React 最先提出来的概念。</p> <p>React 的 JSX ，Vue 的 template 其实都是语法糖，它们本质上都是一个函数，成为 <code>render 函数</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// JSX: &lt;p id=&quot;p1&quot;&gt;hello world&lt;/p&gt;</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'p1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'hello world'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>执行 render 函数返回的就是一个 vdom 对象，一般叫做 vnode（虚拟节点），对应 DOM Node</p> <p>每次数据更新（如 React setState）render 函数都会生成 newVnode ，然后前后对比 <code>diff(vnode, newVnode)</code>，计算出需要修改的 DOM 节点，再做修改。</p> <h3 id="对比-dom-操作"><a href="#对比-dom-操作" class="header-anchor">#</a> 对比 DOM 操作</h3> <p>下面两者，哪个更快？—— 很明显，前者更快。</p> <ul><li>jquery 时代：直接修改 DOM</li> <li>框架时代：生成 vdom ，进行 diff 运算 --&gt; 修改 DOM</li></ul> <p>但凡事都要有一个业务背景。如果页面功能越来越复杂，直接操作 DOM 代码将会难以阅读和维护，大家更希望要“数据视图分离，数据驱动视图”。</p> <p>在这个前提下，哪个更快？ —— 当然是后者。因为业务复杂、代码混乱，将会导致很多无谓的 DOM 操作 —— <strong>DOM 操作是昂贵的</strong></p> <ul><li>直接修改 DOM</li> <li>生成 vdom ，进行 diff 运算 --&gt; 修改 DOM</li></ul> <p>而相比于昂贵的 DOM 操作，JS 运算非常快。所以 JS 多做事情（vdom diff）是更优的选择。</p> <h3 id="答案-3"><a href="#答案-3" class="header-anchor">#</a> 答案</h3> <ul><li>直接进行 DOM 操作永远都是最快的（但要目标明确，不能有无谓的 DOM 操作 —— 这很难）</li> <li>如果业务复杂，要“数据视图分离，数据驱动视图”，无法直接修改 DOM ，那 vdom 就是一个很好的选择</li></ul> <p>所以，<strong>vdom 并不比 DOM 操作更快</strong>（反而更慢，它做了 JS 运算），它只是在某个特定的场景下，无法做到精准 DOM 修改时，一个更优的选择。</p> <h3 id="扩展-2"><a href="#扩展-2" class="header-anchor">#</a> 扩展</h3> <p><a href="https://www.sveltejs.cn/" target="_blank" rel="noopener noreferrer">Svelte<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 不使用 vdom ，它将组件修改，编译为精准的 DOM 操作。和 React 设计思路完全不一样。</p> <p><img src="/assets/img/svelte.35762caa.png" alt=""></p> <h2 id="for-vs-foreach"><a href="#for-vs-foreach" class="header-anchor">#</a> for vs forEach</h2> <h3 id="题目-4"><a href="#题目-4" class="header-anchor">#</a> 题目</h3> <p>for 和 forEach 哪个更快？为什么</p> <h3 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=q, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>for vs forEach<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>for vs forEach<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> length <span class="token operator">=</span> arr<span class="token punctuation">.</span>length

        console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'for'</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> n1 <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            n1<span class="token operator">++</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'for'</span><span class="token punctuation">)</span> <span class="token comment">// 3.7ms</span>

        console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'forEach'</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> n2 <span class="token operator">=</span> <span class="token number">0</span>
        arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n2<span class="token operator">++</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'forEach'</span><span class="token punctuation">)</span> <span class="token comment">// 15.1ms</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="创建函数需要开销"><a href="#创建函数需要开销" class="header-anchor">#</a> 创建函数需要开销</h3> <p>for 直接在当前函数中执行，forEach 每次都要新创建一个函数。
函数有单独的作用域和上下文（可回顾“堆栈模型”），所以耗时更久。</p> <h3 id="答案-4"><a href="#答案-4" class="header-anchor">#</a> 答案</h3> <p>for 更快，因为 forEach 每次创建函数需要开销</p> <h3 id="扩展-3"><a href="#扩展-3" class="header-anchor">#</a> 扩展</h3> <p>开发中不仅要考虑性能，还要考虑代码的可读性，forEach 可读性更好。</p> <h2 id="nodejs-多进程"><a href="#nodejs-多进程" class="header-anchor">#</a> nodejs 多进程</h2> <h3 id="题目-5"><a href="#题目-5" class="header-anchor">#</a> 题目</h3> <p>nodejs 如何开启一个进程，进程之间如何通讯</p> <h3 id="进程-process-和线程-thread"><a href="#进程-process-和线程-thread" class="header-anchor">#</a> 进程 process 和线程 thread</h3> <p>进程，是操作系统进行资源调度和分配的基本单位，每个进程都拥有自己独立的内存区域（参考“堆栈模型”）。
一个进程无法直接访问另一个进程的内存数据，除非通过合法的进程通讯。</p> <p>执行一个 nodejs 文件，即开启了一个进程，可以通过 <code>process.pid</code> 查看进程 id 。</p> <p>线程，是操作系统进行运算调度的最小单位，线程是附属于进程的。一个进程可以包含多个线程（至少一个），多线程之间可共用进程的内存数据。<br>
如操作系统是一个工厂，进程就是一个车间，线程就是一个一个的工人。</p> <p>JS 是单线程的，即执行 JS 时启动一个进程（如 JS 引擎，nodejs 等），然后其中再开启一个线程来执行。<br>
虽然单线程，JS 是基于事件驱动的，它不会阻塞执行，适合高并发的场景。</p> <h3 id="为何需要多进程"><a href="#为何需要多进程" class="header-anchor">#</a> 为何需要多进程</h3> <p>现代服务器都是多核 CPU ，适合同时处理多进程。即，一个进程无法充分利用 CPU 性能，进程数要等于 CPU 核数。</p> <p>服务器一般内存比较大，但操作系统对于一个进程的内存分配是有上限的（2G），所以多进程才能充分利用服务器内存。</p> <h3 id="nodejs-开启多进程"><a href="#nodejs-开启多进程" class="header-anchor">#</a> nodejs 开启多进程</h3> <p><code>child_process.fork</code> 可开启子进程执行单独的计算（源码参考 process-fork.js）</p> <ul><li><code>fork('xxx.js')</code> 开启一个子进程</li> <li>使用 <code>send</code> 发送信息，使用 <code>on</code> 接收信息</li></ul> <p><code>cluster.fork</code> 可针对当前代码，开启多个进程来执行（源码参考 cluster.js）</p> <h3 id="答案-5"><a href="#答案-5" class="header-anchor">#</a> 答案</h3> <ul><li>可使用 <code>child_process.fork</code> 和 <code>cluster.fork</code> 开启子进程</li> <li>使用 <code>send</code> <code>on</code> 传递消息</li></ul> <h3 id="扩展-使用-pm2"><a href="#扩展-使用-pm2" class="header-anchor">#</a> 扩展：使用 PM2</h3> <p>nodejs 服务开启多进程、进程守护，可使用 <a href="https://www.npmjs.com/package/pm2" target="_blank" rel="noopener noreferrer">pm2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，不需要自己写。代码参考 koa2-code</p> <ul><li>全局安装 pm2 <code>yarn global add pm2</code></li> <li>增加 pm2 配置文件</li> <li>修改 package.json scripts</li></ul> <h2 id="js-bridge-原理"><a href="#js-bridge-原理" class="header-anchor">#</a> js-bridge 原理</h2> <h3 id="题目-6"><a href="#题目-6" class="header-anchor">#</a> 题目</h3> <p>请描述 js-bridge 原理</p> <h3 id="微信-jssdk"><a href="#微信-jssdk" class="header-anchor">#</a> 微信 jssdk</h3> <p>微信中的 h5 通过 <a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html" target="_blank" rel="noopener noreferrer">jssdk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 提供的 API 可以调用微信 app 的某些功能。</p> <p>JS 无法直接调用 app 的 API ，需要通过一种方式 —— 通称 js-bridge ，它也是一些 JS 代码。<br>
当然，前提是 app 得开发支持，控制权在 app 端。就像跨域，server 不开放支持，客户端再折腾也没用。</p> <p><img src="/assets/img/js-bridge.117594a8.png" alt=""></p> <h3 id="方式1-注入-api"><a href="#方式1-注入-api" class="header-anchor">#</a> 方式1 - 注入 API</h3> <p>客户端为 webview 做定制开发，在 window 增加一些 API ，共前端调用。</p> <p>例如增加一个 <code>window.getVersion</code> API ，前端 JS 即可调用它来获取 app 版本号。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> v <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但这种方式一般都是<strong>同步</strong>的。<br>
因为你即便你传入了一个 callback 函数，app 也无法执行。app 只能执行一段全局的 JS 代码（像 <code>eval</code>）</p> <h3 id="方式2-劫持-url-scheme"><a href="#方式2-劫持-url-scheme" class="header-anchor">#</a> 方式2 - 劫持 url scheme</h3> <p>一个 iframe 请求 url ，返回的是一个网页。天然支持异步。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> iframe1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'iframe1'</span><span class="token punctuation">)</span>
iframe1<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iframe1<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
iframe1<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:8881/size-unit.html'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上述 url 使用的是标准的 http 协议，如果要改成 <code>'my-app-name://api/getVersion'</code> 呢？—— 默认会报错，<code>'my-app-name'</code> 是一个未识别的协议名称。<br>
既然未识别的协议，那就可以为我所用：app 监听所有的网络请求，遇到 <code>my-app-name:</code> 协议，就分析 path ，并返回响应的内容。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> iframe1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'iframe1'</span><span class="token punctuation">)</span>
iframe1<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iframe1<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span> <span class="token comment">// '{ version: '1.0.1' }'</span>
<span class="token punctuation">}</span>
iframe1<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'my-app-name://api/getVersion'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这种自定义协议的方式，就叫做“url scheme”。微信的 scheme 以 <code>'weixin://'</code> 开头，可搜索“微信 scheme”。</p> <p>chrome 也有自己的 scheme</p> <ul><li><code>chrome://version</code> 查看版本信息</li> <li><code>chrome://dino</code> 恐龙小游戏
其他可参考 https://mp.weixin.qq.com/s/T1Qkt8DTZvpsm8CKtEpNxA</li></ul> <h3 id="封装-sdk"><a href="#封装-sdk" class="header-anchor">#</a> 封装 sdk</h3> <p>scheme 的调用方式非常复杂，不能每个 API 都写重复的代码，所以一般要封装 sdk ，就像微信提供的 jssdk 。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> sdk <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> success<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
        iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>

        iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> content <span class="token operator">=</span> iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML
            <span class="token function">success</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
            iframe<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        iframe<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">err</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            iframe<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">my-app-name://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?data=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>

    <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> success<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'api/fn1'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> success<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> success<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'api/fn2'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> success<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
sdk<span class="token punctuation">.</span><span class="token function">fn1</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="答案-6"><a href="#答案-6" class="header-anchor">#</a> 答案</h3> <p>常用方法：劫持 url scheme</p> <h3 id="扩展-4"><a href="#扩展-4" class="header-anchor">#</a> 扩展</h3> <p>url 长度不够怎么办？—— 可以扩展 ajax post 方式。</p> <h2 id="requestidlecallback"><a href="#requestidlecallback" class="header-anchor">#</a> requestIdleCallback</h2> <h3 id="题目-7"><a href="#题目-7" class="header-anchor">#</a> 题目</h3> <p>是否了解过 requestIdleCallback ？</p> <h3 id="由-react-fiber-引起的关注"><a href="#由-react-fiber-引起的关注" class="header-anchor">#</a> 由 React Fiber 引起的关注</h3> <p>React 16 内部使用 Fiber ，即组件渲染过程可以暂停，先去执行高优任务，CPU 闲置时再继续渲染。<br>
其中用到的核心 API 就是 requestIdleCallback 。</p> <h3 id="requestanimationframe-每次渲染都执行-高优"><a href="#requestanimationframe-每次渲染都执行-高优" class="header-anchor">#</a> requestAnimationFrame 每次渲染都执行，高优</h3> <p>页面的渲染是一帧一帧进行的，至少每秒 60 次（即 16.6ms 一次）才能肉眼感觉流畅。所以，网页动画也要这个帧率才能流畅。</p> <p>用 JS 来控制时间是不靠谱的，因为 JS 执行本身还需要时间，而且 JS 和 DOM 渲染线程互斥。所以 ms 级别的时间会出现误差。<br> <code>requestAnimationFrame</code> 就解决了这个问题，浏览器每次渲染都会执行，不用自己计算时间。</p> <p>代码参考 requestAnimationFrame.html</p> <h3 id="requestidlecallback-空闲时才执行-低优"><a href="#requestidlecallback-空闲时才执行-低优" class="header-anchor">#</a> requestIdleCallback 空闲时才执行，低优</h3> <p>requestIdleCallback 会在网页渲染完成后，CPU 空闲时执行，不一定每一帧都执行。</p> <p>requestIdleCallback 不适合执行 DOM 操作，因为修改了 DOM 之后下一帧不一定会触发修改。</p> <h3 id="宏任务"><a href="#宏任务" class="header-anchor">#</a> 宏任务</h3> <p>requestAnimationFrame 和 requestIdleCallback 都是宏任务，它们比 setTimeout 更晚触发。</p> <h3 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h3> <p>requestAnimationFrame 可用于网页动画。</p> <p>requestIdleCallback 可用于一些低优先级的场景，以代替 setTimeout 。例如发送统计数据。<br>
但请注意 requestIdleCallback 的浏览器兼容性</p> <h3 id="答案-7"><a href="#答案-7" class="header-anchor">#</a> 答案</h3> <p>requestIdleCallback 可在网页渲染完成后，CPU 空闲时执行，用于低优先级的任务处理。</p> <h2 id="vue-react-diff"><a href="#vue-react-diff" class="header-anchor">#</a> Vue React diff</h2> <h3 id="题目-8"><a href="#题目-8" class="header-anchor">#</a> 题目</h3> <p>Vue React diff 算法有什么区别</p> <h3 id="diff-算法"><a href="#diff-算法" class="header-anchor">#</a> diff 算法</h3> <p>diff 算法是一个非常普遍常用的方法，例如提交 github pr 或者（gitlab mr）时，会对比当前提交代码的改动，这就是 diff 。</p> <p>Vue React diff 不是对比文字，而是 vdom 树，即 tree diff 。<br>
传统的 tree diff 算法复杂度是 <code>O(n^3)</code> ，算法不可用。</p> <p><img src="/assets/img/tree-diff.64697ded.png" alt=""></p> <h3 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h3> <p>Vue React 都是用于网页开发，基于 DOM 结构，对 diff 算法都进行了优化（或者简化）</p> <ul><li>只在同一层级比较，不夸层级 （DOM 结构的变化，很少有跨层级移动）</li> <li><code>tag</code> 不同则直接删掉重建，不去对比内部细节（DOM 结构变化，很少有只改外层，不改内层）</li> <li>同一个节点下的子节点，通过 <code>key</code> 区分</li></ul> <p>最终把时间复杂度降低到 <code>O(n)</code> ，生产环境下可用。这一点 Vue React 都是相同的。</p> <p><img src="/assets/img/tree-diff-1.b42eeaa9.png" alt=""></p> <h3 id="react-diff-特点-仅向右移动"><a href="#react-diff-特点-仅向右移动" class="header-anchor">#</a> React diff 特点 - 仅向右移动</h3> <p>比较子节点时，仅向右移动，不向左移动。</p> <p><img src="/assets/img/react-diff.433f2d8a.png" alt=""></p> <h3 id="vue2-diff-特点-双端比较"><a href="#vue2-diff-特点-双端比较" class="header-anchor">#</a> Vue2 diff 特点 - 双端比较</h3> <p><img src="/assets/img/vue2-diff.25702f7b.png" alt=""></p> <p>定义四个指针，分别比较</p> <ul><li>oldStartNode 和 newStartNode</li> <li>oldStartNode 和 newEndNode</li> <li>oldEndNode 和 newStartNode</li> <li>oldEndNode 和 newEndNode</li></ul> <p>然后指针继续向中间移动，知道指针汇合。</p> <h3 id="vue3-diff-特点-最长递增子序列"><a href="#vue3-diff-特点-最长递增子序列" class="header-anchor">#</a> Vue3 diff 特点 - 最长递增子序列</h3> <p>例如数组 <code>[3，5，7，1，2，8]</code> 的最长递增子序列就是 <code>[3，5，7，8 ]</code> 。这是一个专门的算法。</p> <p><img src="/assets/img/vue3-diff.0a002d51.png" alt=""></p> <p>算法步骤</p> <ul><li>通过“前-前”比较找到开始的不变节点 <code>[A, B]</code></li> <li>通过“后-后”比较找到末尾的不变节点 <code>[G]</code></li> <li>剩余的有变化的节点 <code>[F, C, D, E, H]</code> <ul><li>通过 <code>newIndexToOldIndexMap</code> 拿到 oldChildren 中对应的 index <code>[5, 2, 3, 4, -1]</code> （<code>-1</code> 表示之前没有，要新增）</li> <li>计算<strong>最长递增子序列</strong>得到 <code>[2, 3, 4]</code> ，对应的就是 <code>[C, D, E]</code> ，即这些节点可以不变</li> <li>剩余的节点，根据 index 进行新增、删除</li></ul></li></ul> <p>该方法旨在尽量减少 DOM 的移动，达到最少的 DOM 操作。</p> <h3 id="答案-8"><a href="#答案-8" class="header-anchor">#</a> 答案</h3> <ul><li>React diff 特点 - 仅向右移动</li> <li>Vue2 diff 特点 - 双端比较</li> <li>Vue3 diff 特点 - 最长递增子序列</li></ul> <h3 id="划重点-2"><a href="#划重点-2" class="header-anchor">#</a> 划重点</h3> <p>以最小的成本了解原理，知道区别，应对面试。<br>
不要纠结于细节和源码，这会耗费你大量的时间成本 —— 除非你目的就是学习源码，这也不是本课程的重点。</p> <h3 id="连环问-diff-算法中-key-为何如此重要"><a href="#连环问-diff-算法中-key-为何如此重要" class="header-anchor">#</a> 连环问：diff 算法中 key 为何如此重要</h3> <p>无论在 Vue 还是 React 中，<code>key</code> 的作用都非常大。以 React 为例，是否使用 <code>key</code> 对内部 DOM 变化影响非常大。</p> <p><img src="/assets/img/key.34e42571.png" alt=""></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(index, num) in nums<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {{num}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> todoItems <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">todo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="vue-router-模式"><a href="#vue-router-模式" class="header-anchor">#</a> Vue-router 模式</h2> <h3 id="题目-9"><a href="#题目-9" class="header-anchor">#</a> 题目</h3> <p>Vue-router 模式 <code>'hash' | 'history' | 'abstract'</code> 的区别</p> <h3 id="v4-的升级"><a href="#v4-的升级" class="header-anchor">#</a> v4 的升级</h3> <p>Vue-router v4 升级之后，<code>mode: 'xxx'</code> 替换为 API 的形式，但功能是一样的</p> <ul><li><code>mode: 'hash'</code> 替换为 <code>createWebHashHistory()</code></li> <li><code>mode: 'history'</code> 替换为 <code>createWebHistory()</code></li> <li><code>mode: 'abstract'</code> 替换为 <code>createMemoryHistory()</code></li></ul> <p>PS：个人感觉，叫 <code>memory</code> 比叫 <code>abstract</code> 更易理解，前者顾名思义，后者就过于抽象。</p> <h3 id="hash"><a href="#hash" class="header-anchor">#</a> hash</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// http://127.0.0.1:8881/hash.html?a=100&amp;b=20#/aaa/bbb</span>
location<span class="token punctuation">.</span>protocol <span class="token comment">// 'http:'</span>
location<span class="token punctuation">.</span>hostname <span class="token comment">// '127.0.0.1'</span>
location<span class="token punctuation">.</span>host <span class="token comment">// '127.0.0.1:8881'</span>
location<span class="token punctuation">.</span>port <span class="token comment">// '8881'</span>
location<span class="token punctuation">.</span>pathname <span class="token comment">// '/hash.html'</span>
location<span class="token punctuation">.</span>search <span class="token comment">// '?a=100&amp;b=20'</span>
location<span class="token punctuation">.</span>hash <span class="token comment">// '#/aaa/bbb'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>hash 的特点</p> <ul><li>会触发页面跳转，可使用浏览器的“后退” “前进”</li> <li>但不会刷新页面，支持 SPA 必须的特性</li> <li>hash 不会被提交到 server 端（因此刷新页面也会命中当前页面，让前端根据 hash 处理路由）</li></ul> <p>url 中的 hash ，是不会发送给 server 端的。前端 <code>onhashchange</code> 拿到自行处理。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 页面初次加载，获取 hash</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hash'</span><span class="token punctuation">,</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// hash 变化，包括：</span>
<span class="token comment">// a. JS 修改 url</span>
<span class="token comment">// b. 手动修改 url 的 hash</span>
<span class="token comment">// c. 浏览器前进、后退</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onhashchange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'old url'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>oldURL<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'new url'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>newURL<span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hash'</span><span class="token punctuation">,</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="h5-history-api"><a href="#h5-history-api" class="header-anchor">#</a> H5 history API</h3> <p>常用的两个 API</p> <ul><li><code>history.pushState</code></li> <li><code>window.onpopstate</code></li></ul> <p>页面刷新时，<strong>服务端要做处理</strong>，可参考<a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。。即无论什么 url 访问 server ，都要返回该页面。</p> <p>按照 url 规范，不同的 url 对应不同的资源，例如：</p> <ul><li><code>https://github.com/</code> server 返回首页</li> <li><code>https://github.com/username/</code> server 返回用户页</li> <li><code>https://github.com/username/project1/</code> server 返回项目页</li></ul> <p>但是用了 SPA 的前端路由，就改变了这一规则，假如 github 用了的话：</p> <ul><li><code>https://github.com/</code> server 返回首页</li> <li><code>https://github.com/username/</code> server 返回首页，前端路由跳转到用户页</li> <li><code>https://github.com/username/project1/</code> server 返回首页，前端路由跳转到项目页</li></ul> <p>所以，从开发者的实现角度来看，前端路由是一个违反规则的形式。
但是从不关心后端，只关心前端页面的用户，或者浏览器来看，更喜欢 <code>pushState</code> 这种方式。</p> <p>代码参考 history-api.html</p> <h3 id="三种模式的区别"><a href="#三种模式的区别" class="header-anchor">#</a> 三种模式的区别</h3> <ul><li>hash - 使用 url hash 变化记录路由地址</li> <li>history - 使用 H5 history API 来改 url 记录路由地址</li> <li>abstract - 不修改 url ，路由地址在内存中，<strong>但页面刷新会重新回到首页</strong>。</li></ul> <h3 id="连环问-react-router-有几种模式"><a href="#连环问-react-router-有几种模式" class="header-anchor">#</a> 连环问：react-router 有几种模式？</h3> <p>react-router 有三种模式，设计上和 vue-router 一样</p> <ul><li><a href="https://reactrouter.com/web/api/BrowserRouter" target="_blank" rel="noopener noreferrer">browser history<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://reactrouter.com/web/api/HashRouter" target="_blank" rel="noopener noreferrer">hash history<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://reactrouter.com/web/api/MemoryRouter" target="_blank" rel="noopener noreferrer">memory history<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="vue-生命周期"><a href="#vue-生命周期" class="header-anchor">#</a> Vue 生命周期</h2> <p><img src="/assets/img/life.bc5ef8df.png" alt=""></p> <h3 id="beforecreate"><a href="#beforecreate" class="header-anchor">#</a> beforeCreate</h3> <p>初始化一个空的 Vue 实例，<code>data</code> <code>methods</code> 等尚未被初始化，无法调用。</p> <h3 id="created"><a href="#created" class="header-anchor">#</a> created</h3> <p>Vue 实例初始化完成，<code>data</code> <code>methods</code> 都已初始化完成，可调用。<br>
但尚未开始渲染模板。</p> <h3 id="beforemount"><a href="#beforemount" class="header-anchor">#</a> beforeMount</h3> <p>编译模板，调用 <code>render</code> 函数生成 vdom ，但还没有开始渲染 DOM</p> <h3 id="mounted"><a href="#mounted" class="header-anchor">#</a> mounted</h3> <p>渲染 DOM 完成，页面更新。组件创建完成，开始进入运行阶段。</p> <h3 id="beforeupdate"><a href="#beforeupdate" class="header-anchor">#</a> beforeUpdate</h3> <p>在数据发生改变后，DOM 被更新之前被调用。这里适合在现有 DOM 将要被更新之前访问它，比如移除手动添加的事件监听器。</p> <h3 id="updated"><a href="#updated" class="header-anchor">#</a> updated</h3> <p>在数据更改导致的虚拟 DOM 重新渲染和更新完毕之后被调用。</p> <p>注意，尽量不要在 <code>updated</code> 中继续修改数据，否则可能会触发死循环。</p> <h3 id="onactivated"><a href="#onactivated" class="header-anchor">#</a> onActivated</h3> <p>被 <code>keep-alive</code> 缓存的组件激活时调用。</p> <h3 id="ondeactivated"><a href="#ondeactivated" class="header-anchor">#</a> onDeactivated</h3> <p>被 <code>keep-alive</code> 缓存的组件停用时调用。</p> <h3 id="beforeunmount"><a href="#beforeunmount" class="header-anchor">#</a> beforeUnmount</h3> <p>组件进入销毁阶段。</p> <p>卸载组件实例后调用，在这个阶段，实例仍然是完全正常的。<br>
移除、解绑一些全局事件、自定义事件，可以在此时操作。</p> <h3 id="unmounted"><a href="#unmounted" class="header-anchor">#</a> unmounted</h3> <p>卸载组件实例后调用。调用此钩子时，组件实例的所有指令都被解除绑定，所有事件侦听器都被移除，所有子组件实例被卸载。</p> <hr> <h3 id="连环问-如何正确的操作-dom"><a href="#连环问-如何正确的操作-dom" class="header-anchor">#</a> 连环问：如何正确的操作 DOM</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>`mounted` 和 `updated` 都不会保证所有子组件都挂载完成，如果想等待所有视图都渲染完成，需要使用 `$nextTick`
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 仅在整个视图都被渲染之后才会运行的代码</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="连环问-ajax-放在哪个生命周期合适"><a href="#连环问-ajax-放在哪个生命周期合适" class="header-anchor">#</a> 连环问：ajax 放在哪个生命周期合适？</h3> <p>一般有两个选择：<code>created</code> 和 <code>mounted</code> ，建议选择后者 <code>mounted</code> 。</p> <p>执行速度</p> <ul><li>从理论上来说，放在 <code>created</code> 确实会快一些</li> <li>但 ajax 是网络请求，其时间是主要的影响因素。从 <code>created</code> 到 <code>mounted</code> 是 JS 执行，速度非常快。</li> <li>所以，两者在执行速度上不会有肉眼可见的差距</li></ul> <p>代码的阅读和理解</p> <ul><li>放在 <code>created</code> 却会带来一些沟通和理解成本，从代码的执行上来看，它会一边执行组件渲染，一边触发网络请求，并行</li> <li>放在 <code>mounted</code> 就是等待 DOM 渲染完成再执行网络请求，串行，好理解</li></ul> <p>所以，综合来看，更建议选择 <code>mounted</code> 。</p> <h3 id="连环问-composition-api-生命周期有何不同"><a href="#连环问-composition-api-生命周期有何不同" class="header-anchor">#</a> 连环问：Composition API 生命周期有何不同</h3> <ul><li><code>setup</code> 代替了 <code>beforeCreate</code> 和 <code>created</code></li> <li>生命周期换成了函数的形式，如 <code>mounted</code> -&gt; <code>onMounted</code> 参考 https://v3.cn.vuejs.org/api/composition-api.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> onUpdated<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mounted'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">onUpdated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'updated'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/29/2022, 10:30:08 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/algorithm/知识广度-从前端到全栈.html" class="prev">
        知识广度-从前端到全栈
      </a></span> <span class="next"><a href="/algorithm/手写 Promie.html">
        手写 Promise
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><canvas id="vuepress-canvas-cursor"></canvas><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 张晓伟-技术文档
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://assets.smallsunnyfox.com/music/2.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:10px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://assets.smallsunnyfox.com/music/2.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://assets.smallsunnyfox.com/music/2.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>강남역 4번 출구</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Plastic / Fallin` Dild</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/assets/js/app.ac5ad06d.js" defer></script><script src="/assets/js/3.c24abbc0.js" defer></script><script src="/assets/js/13.7502b3ed.js" defer></script>
  </body>
</html>
